<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">
  <title>Node Lifecycle Flow</title>
  <desc>Flowchart showing the lifecycle states and transitions for ROS 2 nodes</desc>

  <!-- Background -->
  <rect width="100%" height="100%" fill="#f8f9fa"/>

  <!-- Title -->
  <text x="400" y="40" font-family="Arial" font-size="20" text-anchor="middle" fill="#2c3e50">ROS 2 Node Lifecycle Flow</text>

  <!-- Initial State -->
  <circle cx="400" cy="80" r="30" fill="#d5f5e3" stroke="#27ae60" stroke-width="2"/>
  <text x="400" y="85" font-family="Arial" font-size="12" text-anchor="middle" fill="#2c3e50">Unconfigured</text>

  <!-- Configuring -->
  <rect x="325" y="140" width="150" height="40" fill="#f8c471" stroke="#e67e22" stroke-width="2" rx="5"/>
  <text x="400" y="165" font-family="Arial" font-size="10" text-anchor="middle" fill="#2c3e50">configuring()</text>

  <!-- Inactive -->
  <circle cx="400" cy="220" r="30" fill="#d5f5e3" stroke="#27ae60" stroke-width="2"/>
  <text x="400" y="225" font-family="Arial" font-size="12" text-anchor="middle" fill="#2c3e50">Inactive</text>

  <!-- Activating -->
  <rect x="325" y="280" width="150" height="40" fill="#f8c471" stroke="#e67e22" stroke-width="2" rx="5"/>
  <text x="400" y="305" font-family="Arial" font-size="10" text-anchor="middle" fill="#2c3e50">activating()</text>

  <!-- Active -->
  <circle cx="400" cy="360" r="30" fill="#e8f4fd" stroke="#3498db" stroke-width="2"/>
  <text x="400" y="365" font-family="Arial" font-size="12" text-anchor="middle" fill="#2c3e50">Active</text>

  <!-- Deactivating -->
  <rect x="150" y="280" width="150" height="40" fill="#f8c471" stroke="#e67e22" stroke-width="2" rx="5"/>
  <text x="225" y="305" font-family="Arial" font-size="10" text-anchor="middle" fill="#2c3e50">deactivating()</text>

  <!-- Cleanup -->
  <rect x="525" y="280" width="150" height="40" fill="#f8c471" stroke="#e67e22" stroke-width="2" rx="5"/>
  <text x="600" y="305" font-family="Arial" font-size="10" text-anchor="middle" fill="#2c3e50">cleaning_up()</text>

  <!-- Error -->
  <circle cx="400" cy="460" r="30" fill="#f5b7b1" stroke="#e74c3c" stroke-width="2"/>
  <text x="400" y="465" font-family="Arial" font-size="12" text-anchor="middle" fill="#2c3e50">Error</text>

  <!-- Shutdown -->
  <circle cx="650" cy="220" r="30" fill="#f5b7b1" stroke="#e74c3c" stroke-width="2"/>
  <text x="650" y="225" font-family="Arial" font-size="12" text-anchor="middle" fill="#2c3e50">Finalized</text>

  <!-- Arrows and transitions -->
  <line x1="400" y1="110" x2="400" y2="140" stroke="#34495e" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="400" y1="180" x2="400" y2="220" stroke="#34495e" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="400" y1="250" x2="400" y2="280" stroke="#34495e" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="400" y1="330" x2="400" y2="360" stroke="#34495e" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="400" y1="390" x2="400" y2="430" stroke="#34495e" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="400" y1="430" x2="400" y2="390" stroke="#e74c3c" stroke-width="2" marker-end="url(#arrowhead)" stroke-dasharray="5,5"/>
  <line x1="370" y1="330" x2="225" y2="320" stroke="#34495e" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="225" y1="280" x2="225" y2="250" stroke="#34495e" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="225" y1="250" x2="370" y2="250" stroke="#34495e" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="430" y1="330" x2="600" y2="320" stroke="#34495e" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="600" y1="280" x2="600" y2="250" stroke="#34495e" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="600" y1="250" x2="430" y2="250" stroke="#34495e" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="430" y1="250" x2="620" y2="250" stroke="#34495e" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="650" y1="250" x2="650" y2="400" stroke="#34495e" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="650" y1="400" x2="430" y2="400" stroke="#34495e" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Transition labels -->
  <text x="420" y="130" font-family="Arial" font-size="9" text-anchor="start" fill="#2c3e50">configure()</text>
  <text x="420" y="210" font-family="Arial" font-size="9" text-anchor="start" fill="#2c3e50">activate()</text>
  <text x="420" y="270" font-family="Arial" font-size="9" text-anchor="start" fill="#2c3e50">deactivate()</text>
  <text x="245" y="270" font-family="Arial" font-size="9" text-anchor="start" fill="#2c3e50">deactivate()</text>
  <text x="525" y="270" font-family="Arial" font-size="9" text-anchor="start" fill="#2c3e50">cleanup()</text>
  <text x="670" y="330" font-family="Arial" font-size="9" text-anchor="start" fill="#2c3e50">shutdown()</text>
  <text x="420" y="450" font-family="Arial" font-size="9" text-anchor="start" fill="#e74c3c">error()</text>

  <!-- Arrowhead Definition -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7"
      refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#34495e"/>
    </marker>
  </defs>

  <!-- Legend -->
  <rect x="50" y="450" width="180" height="80" fill="#ffffff" stroke="#bdc3c7" stroke-width="1"/>
  <text x="140" y="470" font-family="Arial" font-size="12" text-anchor="middle" fill="#2c3e50">Legend</text>
  <circle cx="65" cy="490" r="10" fill="#d5f5e3" stroke="#27ae60"/>
  <text x="85" y="495" font-family="Arial" font-size="10" fill="#2c3e50">States</text>
  <circle cx="65" cy="510" r="10" fill="#e8f4fd" stroke="#3498db"/>
  <text x="85" y="515" font-family="Arial" font-size="10" fill="#2c3e50">Active</text>
  <circle cx="65" cy="530" r="10" fill="#f5b7b1" stroke="#e74c3c"/>
  <text x="85" y="535" font-family="Arial" font-size="10" fill="#2c3e50">Error/Final</text>
  <rect x="60" y="550" width="15" height="15" fill="#f8c471" stroke="#e67e22"/>
  <text x="85" y="562" font-family="Arial" font-size="10" fill="#2c3e50">Transitions</text>
</svg>